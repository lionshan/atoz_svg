<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://unpkg.com/@antv/x6@1.1.1/dist/x6.js"></script>
    <script src="./task.js"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <div id="container"></div>
</body>

<script>
    // class Task extends X6.Node {
    //     // 省略实现细节
    //     constructor() {
    //         super()
    //         this.initConfig()
    //     }
    //     initConfig() {
    //         Task.config({
    //             width: 100,
    //             height: 40,
    //             markup: [
    //                 {
    //                     tagName: 'rect',
    //                     selector: 'body',
    //                 },
    //                 {
    //                     tagName: 'text',
    //                     selector: 'label',
    //                 },
    //                 {
    //                     tagName: 'rect',
    //                     selector: 'progress',
    //                 },

    //             ],
    //             attrs: {
    //                 body: {
    //                     fill: '#ffffff',
    //                     stroke: '#333333',
    //                     strokeWidth: 2,
    //                 },
    //                 progress: {
    //                     fill: '#ffffff',
    //                     stroke: '#333333',
    //                     strokeWidth: 2,
    //                 },
    //                 label: {
    //                     fontSize: 14,
    //                     fill: '#333333',
    //                     refX: '50%',
    //                     refY: '50%',
    //                     textAnchor: 'middle',
    //                     textVerticalAnchor: 'middle',
    //                 },
    //             },
    //             // 通过钩子将自定义选项 label 应用到 'attrs/text/text' 属性上
    //             propHooks(metadata) {
    //                 const { label, ...others } = metadata
    //                 if (label) {
    //                     ObjectExt.setByPath(others, 'attrs/text/text', label)
    //                 }
    //                 return others
    //             },


    //         })
    //     }
    // }
    // X6.Graph.registerNode('task', Task)

    X6.Graph.registerNode('task', {
        inherit: 'rect', // 继承自 Shape.Rect
        width: 120, // 默认宽度
        height: 90, // 默认高度
        markup: [
            {
                tagName: 'rect',
                selector: 'body',
            },
            {
                tagName: 'text',
                selector: 'label',
            },
            {
                tagName: 'text',
                selector: 'label2',
            },
            {
                tagName: 'rect',
                selector: 'progessBg',
            },

            {
                tagName: 'rect',
                selector: 'progess',
            },

            {
                tagName: 'text',
                selector: 'progessLabel',
            },
            {
                tagName: 'image',
                selector: 'img',
            },

        ],
        attrs: {
            body: {
                rx: 10, // 圆角矩形
                strokeWidth: 1,
                fill: '#5755a1',
                stroke: '#5755a1',
            },
            progess: {
                ref: 'body',
                rx: 5, // 圆角矩形
                height: 10,
                refWidth: '50%',
                refX: '0',     // 矩形 x 轴坐标位于节点右下角
                refY: '100%',     // 矩形 y 轴坐标位于节点右下角
                y: -10,
                fill: "#666",
                stroke: "none"
            },
            progessBg: {
                ref: 'body',
                rx: 5, // 圆角矩形
                height: 10,
                refWidth: '100%',
                refX: '0',     // 矩形 x 轴坐标位于节点右下角
                refY: '100%',     // 矩形 y 轴坐标位于节点右下角
                y: -10,
                fill: "#fff",
                strokeWidth: 1
            },
            label: {
                ref: 'body',
                fill: '#fff',
                fontSize: 12,
                refX: '50%',
                refY: '40%',
                textAnchor: 'middle',
                textVerticalAnchor: 'middle',
            },
            label2: {
                ref: 'body',
                fill: '#fff',
                fontSize: 12,
                refX: '50%',
                refY: '60%',
                textAnchor: 'middle',
                textVerticalAnchor: 'middle',
            },
            progessLabel: {
                ref: 'body',
                fill: '#fff',
                fontSize: 12,
                refX: '100%',
                x: -30,
                refY: 10,
                textAnchor: 'right',
            },

            img: {
                ref: 'body',
                refX: 6,
                refY: 6,
                width: 16,
                height: 16,
            }


        },
        propHooks(metadata) {
            console.log('propHookspropHookspropHooks', metadata)
            const { progessLabel, ...others } = metadata
            // if (progessLabel) {
            //     ObjectExt.setByPath(others, 'attrs/text/text', progessLabel)
            // }
            return others
        },
    })
    const data = {
        // 节点
        nodes: [
            {
                id: 'node1', // String，可选，节点的唯一标识
                x: 40,       // Number，必选，节点位置的 x 值
                y: 40,       // Number，必选，节点位置的 y 值
                width: 80,   // Number，可选，节点大小的 width 值
                height: 40,  // Number，可选，节点大小的 height 值
                attrs: {
                    body: {
                        fill: '#2ECC71',
                        stroke: '#000',
                        rx: 10,
                        ry: 10
                    },
                    label: {
                        text: 'hello',
                        fill: '#333',
                        fontSize: 13,
                    },
                },
            },
            // {
            //   id: 'node2', // String，节点的唯一标识
            //   x: 160,      // Number，必选，节点位置的 x 值
            //   y: 180,      // Number，必选，节点位置的 y 值
            //   width: 80,   // Number，可选，节点大小的 width 值
            //   height: 40,  // Number，可选，节点大小的 height 值
            //   label: 'world', // String，节点标签
            //   shape:'task'
            // },
        ],
        // 边
        edges: [
            // {
            //   source: 'node1', // String，必须，起始节点 id
            //   target: 'node2', // String，必须，目标节点 id
            // },
        ],
    };

    const graph = new X6.Graph({
        container: document.getElementById('container'),
        width: 800,
        height: 600,
    });

    // graph.fromJSON(data)

    let xx = graph.addNode({
        x: 100,
        y: 60,
        shape: 'task',
        label: 'My Custom Rect', // label 继承于基类的自定义选项

        progess: 80,
        data: {
            progress: 90,
        },
        attrs: {
            label2: {
                text: 'xxxxxsafasfsaf'
            }, // label 继承于基类的自定义选项
            progessLabel: {
                text: '80%',
            },
            img: {
                'xlink:href':
                    'https://gw.alipayobjects.com/mdn/rms_43231b/afts/img/A*pwLpRr7QPGwAAAAAAAAAAAAAARQnAQ',
            },
        }
    });

    console.log('xxxxx', xx)
</script>

</html>